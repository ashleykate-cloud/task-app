{% extends "base.html" %}

{% block title %}All Tasks (Admin){% endblock %}

{% block content %}
<h2 style="margin-top: 0;">All Tasks</h2>

{% if tasks %}
    <div style="
        background: #ffffff;
        border-radius: 8px;
        padding: 16px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    ">
        <table id="allTasksTable" style="
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        ">
            <thead>
                <tr>
                    <th onclick="sortTable(0)">Title</th>
                    <th onclick="sortTable(1)">Assigned To</th>
                    <th onclick="sortTable(2)">Assigned By</th>
                    <th onclick="sortTable(3)">Due Date</th>
                    <th onclick="sortTable(4)">Status</th>
                    <th>Edit</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                <tr>
                    <td>{{ task['title'] }}</td>
                    <td>{{ task['assigned_to'] }}</td>
                    <td>{{ task['assigned_by'] }}</td>
                    <td>{{ task['due_date'] }}</td>
                    <td>{{ task['status'] }}</td>
                    <td>
                        <a href="{{ url_for('view_task', task_id=task['id']) }}"
                           style="text-decoration: none; color: #1a73e8;">
                            Edit
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <p style="color: #5f6368;">No tasks in the system.</p>
{% endif %}

<script>
function sortTable(colIndex) {
    const table = document.getElementById("allTasksTable");
    const tbody = table.tBodies[0];
    const rows = Array.from(tbody.rows);
    const asc = table.getAttribute("data-sort-dir") !== "asc";
    table.setAttribute("data-sort-dir", asc ? "asc" : "desc");

    rows.sort((a, b) => {
        let A = a.cells[colIndex].innerText.toLowerCase();
        let B = b.cells[colIndex].innerText.toLowerCase();

        const dateA = Date.parse(A);
        const dateB = Date.parse(B);
        if (!isNaN(dateA) && !isNaN(dateB)) {
            A = dateA;
            B = dateB;
        }

        if (A > B) return asc ? 1 : -1;
        if (A < B) return asc ? -1 : 1;
        return 0;
    });

    rows.forEach(row => tbody.appendChild(row));
}
</script>

<style>
th {
    text-align: left;
    padding: 10px;
    cursor: pointer;
    background: #f8f9fa;
    border-bottom: 1px solid #dadce0;
    font-weight: 500;
}

td {
    padding: 10px;
    border-bottom: 1px solid #eee;
}

tr:hover {
    background: #f1f3f4;
}
</style>
{% endblock %}
